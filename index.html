<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>OSION – Fit Calculator (Jeans)</title>
  <meta name="description" content="Jeans Fit Calculator: Größenempfehlung (W/L) mit Messhilfe, Plausibilitätscheck und klaren Hinweisen zur Reduktion von Retouren/Reklamationen." />

  <style>
    :root{
      --bg0:#070a14;
      --bg1:#0b1030;
      --bg2:#171a3a;

      --panel: rgba(18,22,44,.64);
      --panel2: rgba(18,22,44,.42);
      --stroke: rgba(255,255,255,.12);
      --stroke2: rgba(255,255,255,.18);

      --text:#eaf0ff;
      --muted:#b9c2e8;

      --good:#45d483;
      --bad:#ff6b6b;
      --gold:#ffd36a;

      /* OSION-Gradient (Rot/Violett) */
      --a1:#b3003c;
      --a2:#6b2cff;

      --shadow: 0 16px 60px rgba(0,0,0,.45);
      --radius: 18px;
      --radius2: 26px;

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    /* ===== Premium Background ===== */
    body{
      margin:0;
      font-family: var(--sans);
      color: var(--text);
      background:
        radial-gradient(1400px 900px at 22% 12%, rgba(107,44,255,.22), transparent 58%),
        radial-gradient(1100px 820px at 78% 10%, rgba(179,0,60,.22), transparent 58%),
        radial-gradient(900px 700px at 55% 95%, rgba(255,255,255,.06), transparent 62%),
        linear-gradient(180deg, var(--bg0), var(--bg1) 45%, var(--bg2));
      overflow-x:hidden;
    }

    a{ color:inherit; text-decoration:none; }

    .wrap{
      max-width: 980px;
      margin: 0 auto;
      padding: 26px 18px 44px;
    }

    /* ===== Premium Topbar ===== */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding: 14px 14px;
      border: 1px solid rgba(255,255,255,.14);
      border-radius: var(--radius2);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.025));
      box-shadow: 0 22px 80px rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
    }

    .brand{
      display:flex; align-items:center; gap:14px;
      min-width: 240px;
    }
    .logo{
      width:54px; height:54px;
      border-radius: 16px;
      border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(135deg, rgba(179,0,60,.25), rgba(107,44,255,.25));
      display:grid; place-items:center;
      overflow:hidden;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.08);
    }
    .logo img{
      width:100%;
      height:100%;
      object-fit:cover;
      display:block;
    }
    .brand h1{
      margin:0;
      font-size: 15px;
      letter-spacing:.25px;
      font-weight: 900;
      line-height:1.15;
    }
    .brand .sub{
      margin-top:2px;
      font-size: 12px;
      color: rgba(234,240,255,.72);
      line-height:1.2;
    }

    .badgeRow{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
    }
    .pill{
      display:flex; align-items:center; gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      color: rgba(234,240,255,.78);
      font-size: 12px;
      white-space:nowrap;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    .dot{
      width:10px; height:10px; border-radius:999px;
      background: linear-gradient(135deg, var(--a1), var(--a2));
      box-shadow: 0 0 0 3px rgba(255,255,255,.06);
    }

    /* ===== One-column premium layout ===== */
    .grid{
      margin-top: 18px;
      display:grid;
      grid-template-columns: 1fr;
      gap: 16px;
    }

    /* ===== Premium Card ===== */
    .card{
      border: 1px solid rgba(255,255,255,.14);
      border-radius: var(--radius2);
      background:
        radial-gradient(900px 260px at 10% 0%, rgba(255,255,255,.07), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: 0 28px 110px rgba(0,0,0,.55);
      backdrop-filter: blur(12px);
      overflow:hidden;
    }
    .cardHead{
      padding: 16px 16px 0;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
    }
    .cardTitle{
      margin:0;
      font-size: 17px;
      font-weight: 950;
      letter-spacing:.3px;
    }
    .cardHint{
      margin: 6px 0 0;
      font-size: 13px;
      color: rgba(234,240,255,.72);
      line-height:1.35;
    }
    .cardBody{
      padding: 14px 16px 16px;
    }

    .row{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 12px;
    }
    @media (max-width: 560px){
      .row{ grid-template-columns: 1fr; }
      .badgeRow{ justify-content:flex-start; }
      .brand{ min-width:auto; }
    }

    label{
      display:block;
      font-size: 12px;
      color: rgba(234,240,255,.72);
      margin: 0 0 6px;
    }
    .field{
      position:relative;
    }

    /* ===== Premium Inputs ===== */
    input, select{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background:
        linear-gradient(180deg, rgba(10,12,28,.72), rgba(10,12,28,.46));
      color: var(--text);
      outline:none;
      transition: border-color .15s ease, transform .15s ease, box-shadow .15s ease;
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.06),
        0 10px 30px rgba(0,0,0,.35);
    }
    input::placeholder{ color: rgba(185,194,232,.55); }
    input:focus, select:focus{
      border-color: rgba(255,255,255,.28);
      transform: translateY(-1px);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.07),
        0 0 0 4px rgba(107,44,255,.14),
        0 10px 34px rgba(0,0,0,.4);
    }

    .suffix{
      position:absolute;
      right: 10px;
      top: 34px;
      font-size: 12px;
      color: rgba(234,240,255,.65);
      pointer-events:none;
    }

    .actions{
      display:flex;
      gap: 10px;
      flex-wrap:wrap;
      margin-top: 8px;
    }

    /* ===== Premium Buttons ===== */
    .btn{
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.045);
      color: var(--text);
      padding: 11px 12px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 900;
      letter-spacing:.2px;
      transition: transform .15s ease, border-color .15s ease, background .15s ease;
      box-shadow: 0 14px 40px rgba(0,0,0,.35);
    }
    .btn:hover{ transform: translateY(-1px); border-color: rgba(255,255,255,.25); }
    .btn.primary{
      border-color: rgba(255,255,255,.18);
      background: linear-gradient(135deg, rgba(179,0,60,.34), rgba(107,44,255,.34));
    }
    .btn.primary:hover{
      background: linear-gradient(135deg, rgba(179,0,60,.42), rgba(107,44,255,.42));
    }
    .btn.ghost{
      background: transparent;
      box-shadow: none;
    }

    /* ===== Premium Result Card ===== */
    .result{
      margin-top: 12px;
      padding: 14px;
      border-radius: var(--radius2);
      border: 1px solid rgba(255,255,255,.16);
      background:
        radial-gradient(820px 240px at 0% 0%, rgba(179,0,60,.14), transparent 55%),
        radial-gradient(820px 240px at 100% 0%, rgba(107,44,255,.14), transparent 55%),
        linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      box-shadow: 0 26px 90px rgba(0,0,0,.55);
    }

    .resultTop{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap: 12px;
      flex-wrap:wrap;
    }

    .sizeBig{
      display:flex;
      gap: 10px;
      align-items:baseline;
      flex-wrap:wrap;
    }
    .sizeBig .w{
      font-size: 28px;
      font-weight: 950;
      letter-spacing:.6px;
      display:inline-block;
      padding: 10px 14px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.04);
      box-shadow: inset 0 1px 0 rgba(255,255,255,.06);
    }
    .sizeBig .meta{
      font-size: 13px;
      color: rgba(234,240,255,.72);
      margin-top: 8px;
    }

    .confidence{
      min-width: 260px;
      max-width: 320px;
      flex: 1;
    }
    .confLabel{
      font-size: 12px;
      color: rgba(234,240,255,.72);
      margin-bottom: 6px;
      display:flex;
      justify-content:space-between;
      gap: 12px;
    }
    .bar{
      height: 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.22);
      overflow:hidden;
    }
    .bar > i{
      display:block;
      height:100%;
      width:0%;
      background: linear-gradient(90deg, var(--bad), var(--gold), var(--good));
      border-radius: 999px;
      transition: width .3s ease;
    }

    .bullets{
      margin: 10px 0 0;
      padding: 0 0 0 16px;
      color: rgba(234,240,255,.72);
      line-height:1.45;
      font-size: 13px;
    }

    .note{
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px dashed rgba(255,255,255,.22);
      background: rgba(255,255,255,.03);
      color: rgba(234,240,255,.72);
      font-size: 12px;
      line-height:1.45;
    }

    .miniGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 12px;
    }
    @media (max-width: 560px){
      .miniGrid{ grid-template-columns: 1fr; }
    }

    .tile{
      border: 1px solid rgba(255,255,255,.12);
      border-radius: var(--radius2);
      background: rgba(255,255,255,.028);
      padding: 12px;
    }
    .tile h3{
      margin:0;
      font-size: 13px;
      letter-spacing:.25px;
      font-weight: 950;
    }
    .tile p{
      margin: 6px 0 0;
      font-size: 12px;
      color: rgba(234,240,255,.72);
      line-height:1.45;
    }

    .divider{
      height:1px;
      background: rgba(255,255,255,.08);
      margin: 14px 0;
    }

    /* ===== Modal ===== */
    .modalBackdrop{
      position:fixed;
      inset:0;
      background: rgba(0,0,0,.62);
      display:none;
      align-items:center;
      justify-content:center;
      padding: 18px;
      z-index: 50;
    }
    .modal{
      width:min(860px, 100%);
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.18);
      background: linear-gradient(180deg, rgba(18,22,44,.92), rgba(10,12,28,.92));
      box-shadow: 0 24px 90px rgba(0,0,0,.6);
      overflow:hidden;
    }
    .modalHead{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap: 10px;
      padding: 14px 16px;
      border-bottom:1px solid rgba(255,255,255,.10);
    }
    .modalHead b{ font-size: 14px; letter-spacing:.2px; }
    .modalBody{
      padding: 14px 16px 16px;
      color: rgba(234,240,255,.72);
      line-height:1.5;
      font-size: 13px;
    }
    .closeX{
      border:1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.04);
      color: var(--text);
      border-radius: 12px;
      padding: 10px 12px;
      cursor:pointer;
      font-weight: 950;
    }

    .svgWrap{
      margin-top: 10px;
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      background: rgba(255,255,255,.03);
      padding: 12px;
    }

    .foot{
      margin-top: 12px;
      font-size: 12px;
      color: rgba(255,255,255,.55);
      text-align:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <!-- Logo-Datei ins Repo legen (Root). Dateiname ggf. anpassen -->
          <img src="MGU-0015 Logo OSION Solution XR.png" alt="OSION Logo"
               onerror="this.style.display='none'; this.parentElement.textContent='OSION'; this.parentElement.style.fontWeight='950'; this.parentElement.style.fontSize='14px';" />
        </div>
        <div>
          <h1>OSION Fit Calculator – Jeans</h1>
          <div class="sub">Größenempfehlung (W/L) mit Messhilfe, Plausibilitätscheck, Begründung</div>
        </div>
      </div>

      <div class="badgeRow">
        <div class="pill"><span class="dot"></span> Fokus: weniger Retouren & Reklamationen</div>
        <div class="pill">Output: W/L + Hinweise + Sicherheitsgrad</div>
      </div>
    </div>

    <div class="grid">
      <section class="card" aria-label="Eingaben">
        <div class="cardHead">
          <div>
            <h2 class="cardTitle">Deine Daten</h2>
            <p class="cardHint">Wenn du deinen <b>Taille-Umfang</b> und deine <b>Innenbeinlänge</b> kennst, wird die Empfehlung deutlich präziser.</p>
          </div>
          <button class="btn ghost" id="openMeasure">Messhilfe</button>
        </div>

        <div class="cardBody">
          <div class="row">
            <div class="field">
              <label for="height">Körpergröße</label>
              <input id="height" type="number" inputmode="numeric" min="120" max="220" placeholder="z. B. 182" />
              <div class="suffix">cm</div>
            </div>

            <div class="field">
              <label for="weight">Gewicht</label>
              <input id="weight" type="number" inputmode="numeric" min="35" max="200" placeholder="z. B. 84" />
              <div class="suffix">kg</div>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="waist">Taille-Umfang (optional, empfohlen)</label>
              <input id="waist" type="number" inputmode="numeric" min="55" max="140" placeholder="z. B. 88" />
              <div class="suffix">cm</div>
            </div>

            <div class="field">
              <label for="inseam">Innenbeinlänge (optional, empfohlen)</label>
              <input id="inseam" type="number" inputmode="numeric" min="55" max="105" placeholder="z. B. 82" />
              <div class="suffix">cm</div>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="fit">Sitz (wie soll die Jeans sitzen?)</label>
              <select id="fit">
                <option value="regular" selected>Normal</option>
                <option value="slim">Enger</option>
                <option value="loose">Lockerer</option>
              </select>
            </div>

            <div class="field">
              <label for="stretch">Stretch-Anteil</label>
              <select id="stretch">
                <option value="none">Kein Stretch (100% Denim)</option>
                <option value="some" selected>Etwas Stretch (1–3%)</option>
                <option value="high">Viel Stretch (4%+)</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label for="rise">Bundhöhe</label>
              <select id="rise">
                <option value="mid" selected>Mid Rise (Standard)</option>
                <option value="low">Low Rise</option>
                <option value="high">High Rise</option>
              </select>
            </div>

            <div class="field">
              <label for="brand">Passform-Tendenz (optional)</label>
              <select id="brand">
                <option value="tts" selected>Fällt normal aus</option>
                <option value="small">Fällt eher klein aus</option>
                <option value="large">Fällt eher groß aus</option>
              </select>
            </div>
          </div>

          <div class="actions">
            <button class="btn primary" id="calc">Empfehlung berechnen</button>
            <button class="btn" id="reset">Zurücksetzen</button>
            <button class="btn ghost" id="copy">Ergebnis kopieren</button>
          </div>

          <div class="result" id="result" style="display:none;">
            <div class="resultTop">
              <div>
                <div class="sizeBig">
                  <div class="w" id="sizeWL">W32 / L32</div>
                  <div class="meta" id="sizeMeta">entspricht ungefähr EU 48–50 · Gürtelmaß ca. 95–100 cm</div>
                </div>
              </div>

              <div class="confidence">
                <div class="confLabel">
                  <span>Sicherheitsgrad</span>
                  <b id="confText">hoch</b>
                </div>
                <div class="bar" aria-label="Sicherheitsgrad Balken"><i id="confBar"></i></div>
              </div>
            </div>

            <ul class="bullets" id="bullets"></ul>

            <div class="note" id="note"></div>

            <div class="miniGrid">
              <div class="tile">
                <h3>Warum diese Empfehlung?</h3>
                <p id="why">Basierend auf Taille/Innenbeinlänge (oder plausibler Schätzung), plus Sitz, Stretch und Passform-Tendenz.</p>
              </div>
              <div class="tile">
                <h3>So reduzierst du Fehlkäufe</h3>
                <p id="how">Wenn du Taille + Innenbeinlänge misst, steigt die Treffsicherheit deutlich. Bei Unsicherheit zwischen zwei Größen: hier steht klar, wann welche sinnvoll ist.</p>
              </div>
            </div>
          </div>

          <div class="divider"></div>

          <div class="tile">
            <h3Messdaten erfassen (optional, aber stark gegen Retouren)</h3>
            <p>
              Empfehlung wird maximal präzise mit: <b>Taille-Umfang</b> und <b>Innenbeinlänge</b>.
              Ohne Messwerte nutzt der Calculator eine Schätzung – das ist solide, aber weniger exakt.
            </p>
          </div>

          <div class="foot">OSION · Fit Calculator · Jeans</div>
        </div>
      </section>
    </div>
  </div>

  <!-- MODAL: Messhilfe -->
  <div class="modalBackdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-label="Messhilfe">
    <div class="modal">
      <div class="modalHead">
        <b>Messhilfe – Taille & Innenbeinlänge</b>
        <button class="closeX" id="closeMeasure">Schließen</button>
      </div>
      <div class="modalBody">
        <div>
          <b>Taille-Umfang:</b> Maßband auf Höhe, wo die Jeans sitzen soll. Maßband eng anliegend, nicht einschnüren.
        </div>
        <div style="margin-top:8px;">
          <b>Innenbeinlänge:</b> Von Schritt bis Knöchel (oder bis gewünschter Saum). Am besten eine gut passende Jeans messen.
        </div>

        <div class="svgWrap" aria-hidden="true">
          <svg viewBox="0 0 820 220" width="100%" height="auto">
            <defs>
              <linearGradient id="g" x1="0" x2="1">
                <stop offset="0" stop-color="#b3003c" stop-opacity=".9"/>
                <stop offset="1" stop-color="#6b2cff" stop-opacity=".9"/>
              </linearGradient>
            </defs>
            <circle cx="110" cy="55" r="26" fill="rgba(255,255,255,.08)" stroke="rgba(255,255,255,.18)"/>
            <rect x="86" y="82" width="48" height="96" rx="18" fill="rgba(255,255,255,.06)" stroke="rgba(255,255,255,.18)"/>
            <rect x="72" y="118" width="20" height="74" rx="10" fill="rgba(255,255,255,.06)" stroke="rgba(255,255,255,.18)"/>
            <rect x="128" y="118" width="20" height="74" rx="10" fill="rgba(255,255,255,.06)" stroke="rgba(255,255,255,.18)"/>
            <line x1="68" y1="120" x2="152" y2="120" stroke="url(#g)" stroke-width="6" stroke-linecap="round"/>
            <text x="175" y="126" fill="rgba(255,255,255,.75)" font-size="14">Taille-Umfang</text>

            <path d="M400 42 h80 l12 150 h-34 l-10-95 h-16 l-10 95 h-34z"
                  fill="rgba(255,255,255,.06)" stroke="rgba(255,255,255,.18)" stroke-width="2"/>
            <line x1="440" y1="100" x2="440" y2="190" stroke="url(#g)" stroke-width="6" stroke-linecap="round"/>
            <text x="470" y="150" fill="rgba(255,255,255,.75)" font-size="14">Innenbeinlänge</text>

            <rect x="560" y="54" width="240" height="130" rx="18" fill="rgba(255,255,255,.04)" stroke="rgba(255,255,255,.14)"/>
            <text x="578" y="84" fill="rgba(255,255,255,.8)" font-size="13">Tipp:</text>
            <text x="578" y="108" fill="rgba(255,255,255,.72)" font-size="12">Lieblingsjeans flach hinlegen,</text>
            <text x="578" y="128" fill="rgba(255,255,255,.72)" font-size="12">Taille + Innenbeinlänge messen.</text>
            <text x="578" y="148" fill="rgba(255,255,255,.72)" font-size="12">Das bringt maximale Treffsicherheit.</text>
          </svg>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      const $ = (id) => document.getElementById(id);

      const el = {
        height: $("height"),
        weight: $("weight"),
        waist: $("waist"),
        inseam: $("inseam"),
        fit: $("fit"),
        stretch: $("stretch"),
        rise: $("rise"),
        brand: $("brand"),

        calc: $("calc"),
        reset: $("reset"),
        copy: $("copy"),

        result: $("result"),
        sizeWL: $("sizeWL"),
        sizeMeta: $("sizeMeta"),
        bullets: $("bullets"),
        note: $("note"),
        why: $("why"),
        how: $("how"),

        confBar: $("confBar"),
        confText: $("confText"),

        openMeasure: $("openMeasure"),
        closeMeasure: $("closeMeasure"),
        modalBackdrop: $("modalBackdrop")
      };

      const clamp = (n, a, b) => Math.max(a, Math.min(b, n));

      function roundToNearest(n, step){
        return Math.round(n/step)*step;
      }

      function mapL(inches){
        const options = [28,30,32,34,36];
        let best = options[0], bestD = Infinity;
        for (const o of options){
          const d = Math.abs(o - inches);
          if (d < bestD){ bestD = d; best = o; }
        }
        return best;
      }

      function mapW(inches){
        const w = clamp(Math.round(inches), 26, 44);
        return w;
      }

      function euApproxFromW(w){
        const base = 44 + (w - 28);
        return Math.round(base/2)*2;
      }

      function beltApproxFromWaistCm(waistCm){
        if (!waistCm) return null;
        return roundToNearest(waistCm + 7, 5);
      }

      function estimateInseamCmFromHeight(heightCm){
        return heightCm ? Math.round(heightCm * 0.45) : null;
      }

      function estimateWaistCmFromHeightWeight(heightCm, weightKg){
        if (!heightCm || !weightKg) return null;
        const hM = heightCm / 100;
        const bmi = weightKg / (hM*hM);

        let waist = heightCm * 0.42 + (bmi - 22) * 1.8;
        waist = clamp(waist, 68, 125);
        return Math.round(waist);
      }

      function confidenceScore(inputsUsed){
        let score = 35;
        if (inputsUsed.waist) score += 35;
        if (inputsUsed.inseam) score += 25;
        if (inputsUsed.height && inputsUsed.weight) score += 8;
        score = clamp(score, 20, 95);
        return score;
      }

      function confLabel(score){
        if (score >= 78) return "hoch";
        if (score >= 55) return "mittel";
        return "niedrig";
      }

      function escapeHtml(str){
        return String(str)
          .replaceAll("&","&amp;")
          .replaceAll("<","&lt;")
          .replaceAll(">","&gt;")
          .replaceAll('"',"&quot;")
          .replaceAll("'","&#039;");
      }

      function platformTracking(eventName, payload){
        try{
          window.dataLayer = window.dataLayer || [];
          window.dataLayer.push({ event: eventName, ...payload });
        }catch(e){}
      }

      function compute(){
        const heightCm = Number(el.height.value || 0) || null;
        const weightKg = Number(el.weight.value || 0) || null;
        const waistCmIn = Number(el.waist.value || 0) || null;
        const inseamCmIn = Number(el.inseam.value || 0) || null;

        const fit = el.fit.value;
        const stretch = el.stretch.value;
        const rise = el.rise.value;
        const brand = el.brand.value;

        const waistCm = waistCmIn || estimateWaistCmFromHeightWeight(heightCm, weightKg);
        const inseamCm = inseamCmIn || estimateInseamCmFromHeight(heightCm);

        const waistIn = waistCm ? waistCm / 2.54 : null;
        const inseamIn = inseamCm ? inseamCm / 2.54 : null;

        let W = waistIn ? mapW(waistIn) : 32;
        let L = inseamIn ? mapL(Math.round(inseamIn)) : 32;

        if (fit === "slim") W -= 1;
        if (fit === "loose") W += 1;

        if (stretch === "high") W -= 1;

        if (brand === "small") W += 1;
        if (brand === "large") W -= 1;

        W = clamp(W, 26, 44);

        const eu = euApproxFromW(W);
        const belt = beltApproxFromWaistCm(waistCmIn || null);

        const used = {
          waist: Boolean(waistCmIn),
          inseam: Boolean(inseamCmIn),
          height: Boolean(heightCm),
          weight: Boolean(weightKg)
        };

        const score = confidenceScore(used);
        const label = confLabel(score);

        const bullets = [];
        const notes = [];

        if (used.waist){
          bullets.push(`Taille gemessen: ${waistCmIn} cm → W${W}.`);
        } else {
          bullets.push(`Taille nicht gemessen → Schätzung genutzt. Für maximale Treffsicherheit Taille messen.`);
          notes.push(`Ohne gemessene Taille ist die Empfehlung konservativ. Messung bringt deutlich höhere Sicherheit.`);
        }

        if (used.inseam){
          bullets.push(`Innenbeinlänge gemessen: ${inseamCmIn} cm → L${L}.`);
        } else {
          bullets.push(`Innenbeinlänge nicht gemessen → Schätzung genutzt. Für exakten Sitz Innenbeinlänge messen.`);
          notes.push(`Innenbeinlänge beeinflusst den Sitz stark. Messung bringt deutlich höhere Sicherheit.`);
        }

        bullets.push(`Sitz: ${fit === "slim" ? "enger" : fit === "loose" ? "lockerer" : "normal"} · Stretch: ${stretch === "high" ? "viel" : stretch === "none" ? "kein" : "etwas"}.`);

        if (brand !== "tts"){
          bullets.push(`Passform-Tendenz berücksichtigt: ${brand === "small" ? "fällt klein aus" : "fällt groß aus"}.`);
        }

        const betweenHint = (stretch === "high" || fit === "slim")
          ? `Wenn du zwischen zwei Größen liegst: eher die kleinere nehmen (wegen Stretch/enger Sitz).`
          : `Wenn du zwischen zwei Größen liegst: eher die größere nehmen (mehr Komfort).`;
        notes.push(betweenHint);

        notes.push(`Hinweis: Maßangaben und Sitz-Hinweise auf der Produktseite sind entscheidend.`);

        const why = [
          `Basis: ${used.waist ? "gemessene Taille" : "Taille-Schätzung"} + ${used.inseam ? "gemessene Innenbeinlänge" : "Innenbein-Schätzung"}.`,
          `Anpassung: Sitz (${fit}) + Stretch (${stretch}) + Passform-Tendenz (${brand}).`
        ].join(" ");

        const how = `Bestes Ergebnis: Taille + Innenbeinlänge messen (oder Lieblingsjeans messen). Das reduziert Fehlkäufe und damit Retouren/Reklamationen.`;

        el.sizeWL.textContent = `W${W} / L${L}`;
        const beltTxt = belt ? ` · Gürtelmaß ca. ${belt} cm` : ``;
        el.sizeMeta.textContent = `entspricht ungefähr EU ${eu}${beltTxt}`;

        el.bullets.innerHTML = bullets.map(x => `<li>${escapeHtml(x)}</li>`).join("");
        el.note.textContent = notes.join(" ");

        el.why.textContent = why;
        el.how.textContent = how;

        el.confText.textContent = label;
        el.confBar.style.width = `${score}%`;

        el.result.style.display = "block";

        platformTracking("oson_fit_calc_result", {
          category: "jeans",
          W, L,
          confidence: score,
          usedWaist: used.waist,
          usedInseam: used.inseam,
          fit, stretch, rise, brand
        });

        return { W, L, eu, belt, score, label, bullets, notes };
      }

      function reset(){
        el.height.value = "";
        el.weight.value = "";
        el.waist.value = "";
        el.inseam.value = "";
        el.fit.value = "regular";
        el.stretch.value = "some";
        el.rise.value = "mid";
        el.brand.value = "tts";
        el.result.style.display = "none";
        el.confBar.style.width = "0%";
        el.confText.textContent = "";
        platformTracking("oson_fit_calc_reset", { category: "jeans" });
      }

      async function copyResult(){
        if (el.result.style.display === "none"){
          alert("Bitte erst berechnen.");
          return;
        }
        const txt = `${el.sizeWL.textContent} – ${el.sizeMeta.textContent}\nHinweise:\n- ${[...el.bullets.querySelectorAll("li")].map(li=>li.textContent).join("\n- ")}\n\n${el.note.textContent}`;
        try{
          await navigator.clipboard.writeText(txt);
          platformTracking("oson_fit_calc_copy", { category: "jeans" });
          alert("Ergebnis kopiert.");
        }catch(e){
          alert("Kopieren nicht möglich. Bitte manuell markieren.");
        }
      }

      function openModal(){
        el.modalBackdrop.style.display = "flex";
      }
      function closeModal(){
        el.modalBackdrop.style.display = "none";
      }

      el.calc.addEventListener("click", compute);
      el.reset.addEventListener("click", reset);
      el.copy.addEventListener("click", copyResult);

      el.openMeasure.addEventListener("click", openModal);
      el.closeMeasure.addEventListener("click", closeModal);
      el.modalBackdrop.addEventListener("click", (e)=>{ if(e.target === el.modalBackdrop) closeModal(); });

      platformTracking("oson_fit_calc_view", { category: "jeans" });
    })();
  </script>
</body>
</html>
